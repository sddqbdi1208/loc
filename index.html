<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Send Location</title>
</head>
<body>

<button id="sendBtn">Kirim Lokasi</button>

<pre id="log"></pre>

<script>
const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbw5ajWqfPwU04qMWqA8bF19RTN8lD7HXAVZMG5EbQMy9LMUp0K6VDry6PPMC0icoSdU/exec";

function log(msg) {
    document.getElementById("log").textContent += msg + "\n";
}

document.getElementById("sendBtn").onclick = () => {
    if (!confirm("Apakah kamu yakin ingin mengirim lokasi?")) return;

    log("• Konfirmasi OK");
    log("• Mengambil IP…");

    fetch("https://api.ipify.org?format=json")
        .then(res => res.json())
        .then(ipData => {
            const ip = ipData.ip;
            log("• IP: " + ip);

            log("• Mengambil lokasi…");
            navigator.geolocation.getCurrentPosition(
                pos => {
                    log("• Lokasi berhasil didapat");

                    const data = {
                        latitude: pos.coords.latitude,
                        longitude: pos.coords.longitude,
                        accuracy: pos.coords.accuracy,
                        ip: ip,
                        userAgent: navigator.userAgent
                    };

                    log("• Mengirim ke server…");

                    fetch(WEB_APP_URL, {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify(data)
                    })
                    .then(r => r.text())
                    .then(t => log("• Server: " + t))
                    .catch(err => log("• ERROR kirim data: " + err));

                },
                err => log("• ERROR lokasi: " + err.message),
                { enableHighAccuracy: true }
            );
        });
};
</script>

</body>
</html>
